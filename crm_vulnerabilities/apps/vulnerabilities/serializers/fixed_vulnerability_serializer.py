from rest_framework import serializers
from apps.vulnerabilities.models import Vulnerability
from apps.vulnerabilities.clients.nvd_client import NVDClient


class FixedVulnerabilitySerializer(serializers.ModelSerializer):
    """Serializer para vulnerabilidades fixeadas que se almacenan en la base de datos"""

    class Meta:
        model = Vulnerability
        fields = ["id", "description", "severity", "is_fixed", "added_at"]
        read_only_fields = ["is_fixed", "added_at"]

        def validate_id(self, value):
            nvd_client = NVDClient()
            if not nvd_client.vulnerability_exists(value):
                raise serializers.ValidationError(
                    f"La vulnerabilidad {value} no existe en NIST."
                )
